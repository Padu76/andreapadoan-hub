<!DOCTYPE html>
<html lang="it" itemscope itemtype="http://schema.org/Person">
<head>
    <!-- Meta Tag Base -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Andrea PT">
    <meta name="application-name" content="Andrea PT">
    <meta name="msapplication-TileColor" content="#ff6b35">
    <meta name="theme-color" content="#ff6b35">
    <meta name="color-scheme" content="dark light">
    
    <!-- SEO Meta Tags Ottimizzati -->
    <title>Andrea Padoan: Personal Trainer e Lifestyle Coach Verona | La Mia Storia</title>
    <meta name="description" content="Scopri la storia di Andrea Padoan, Personal Trainer e Lifestyle Coach a Verona. Da manager stanco a imprenditore del benessere che aiuta professionisti a trasformare corpo e mente. Tribù Studio Verona.">
    <meta name="keywords" content="Andrea Padoan, Personal Trainer Verona, Lifestyle Coach Verona, Tribù Studio, Allenamento Personalizzato Verona, Coach Trasformazione, Personal Training Verona, Palestra Verona">
    
    <!-- SEO Avanzato -->
    <meta name="author" content="Andrea Padoan">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://andreapadoan-hub.vercel.app/chi-sono.html">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon PWA -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="./images/icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./images/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/icon-16x16.png">
    <link rel="mask-icon" href="./images/safari-pinned-tab.svg" color="#ff6b35">
    
    <!-- Open Graph per Social Media -->
    <meta property="og:type" content="profile">
    <meta property="og:title" content="Andrea Padoan: Personal Trainer e Lifestyle Coach Verona | La Mia Storia">
    <meta property="og:description" content="Da manager stanco a Personal Trainer di successo. Scopri come ho trasformato la mia vita e quella di centinaia di clienti a Verona.">
    <meta property="og:image" content="https://andreapadoan-hub.vercel.app/images/chi-sono.jpg">
    <meta property="og:image:alt" content="Andrea Padoan Personal Trainer Verona">
    <meta property="og:url" content="https://andreapadoan-hub.vercel.app/chi-sono.html">
    <meta property="og:site_name" content="Andrea Padoan Hub">
    <meta property="og:locale" content="it_IT">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Andrea Padoan: Personal Trainer e Lifestyle Coach Verona">
    <meta name="twitter:description" content="Da manager stanco a Personal Trainer di successo. La mia storia di trasformazione.">
    <meta name="twitter:image" content="https://andreapadoan-hub.vercel.app/images/chi-sono.jpg">
    
    <!-- Performance Optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//wa.me">
    <link rel="dns-prefetch" href="//www.google.com">
    <link rel="dns-prefetch" href="//www.youtube.com">
    
    <!-- Critical Resources Preload -->
    <link rel="preload" as="image" href="./images/chi-sono.webp" type="image/webp">
    <link rel="preload" as="image" href="./images/chi-sono.jpg" type="image/jpeg">
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Font Awesome con preload -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Critical CSS Inlined -->
    <style>
        /* ===== CRITICAL CSS - Above the fold ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            /* PWA Safe Areas */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* Mobile-first critical styles */
        .home-button {
            position: fixed;
            top: max(20px, env(safe-area-inset-top, 20px));
            left: max(20px, env(safe-area-inset-left, 20px));
            z-index: 1001;
            background: linear-gradient(45deg, #ff6b35, #ff8533);
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            touch-action: manipulation;
        }

        .home-button:active {
            transform: scale(0.95);
        }

        /* Mobile-optimized sticky CTA */
        .sticky-cta {
            position: fixed;
            bottom: max(20px, env(safe-area-inset-bottom, 20px));
            right: max(20px, env(safe-area-inset-right, 20px));
            z-index: 1000;
            background: linear-gradient(45deg, #25D366, #20BA5A);
            color: white;
            border: none;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(37, 211, 102, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .sticky-cta:active {
            transform: scale(0.9);
        }

        /* Hero section mobile-first */
        .hero-section {
            padding: max(120px, calc(80px + env(safe-area-inset-top))) 20px 80px;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 50%, #000 100%);
            min-height: 100vh;
            min-height: 100dvh; /* Dynamic viewport height */
            display: flex;
            align-items: center;
        }

        .hero-content {
            display: flex;
            flex-direction: column;
            gap: 40px;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            text-align: center;
        }

        .hero-title {
            font-size: clamp(2.5rem, 8vw, 5.5rem);
            font-weight: 900;
            color: #ff6b35;
            margin-bottom: 15px;
            line-height: 1;
            letter-spacing: -2px;
        }

        .hero-impact {
            font-size: clamp(1.4rem, 5vw, 2.8rem);
            color: #fff;
            margin-bottom: 20px;
            font-weight: 700;
            line-height: 1.2;
        }

        /* Container mobile-optimized */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 15px 50px;
        }

        /* Touch-friendly navigation */
        .nav-anchors {
            display: none; /* Hidden on mobile by default */
        }

        /* Loading states */
        .component-loading {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(26, 26, 26, 0.5);
            border-radius: 15px;
            margin: 20px 0;
        }

        .component-loading::after {
            content: '';
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 107, 53, 0.3);
            border-top-color: #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Breadcrumb mobile */
        .breadcrumb {
            background: rgba(26, 26, 26, 0.8);
            padding: 10px 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .breadcrumb-list {
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 1200px;
            margin: 0 auto;
            font-size: 12px;
        }

        .breadcrumb-item {
            color: #b0b0b0;
            text-decoration: none;
            transition: color 0.3s ease;
            touch-action: manipulation;
        }

        .breadcrumb-item:active {
            color: #ff6b35;
        }

        .breadcrumb-item.active {
            color: #ff6b35;
            font-weight: 600;
        }

        .breadcrumb-separator {
            color: #666;
            margin: 0 3px;
        }

        /* Performance optimizations */
        img {
            max-width: 100%;
            height: auto;
            loading: lazy;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Touch improvements */
        button, a, [role="button"] {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Desktop optimizations */
        @media (min-width: 768px) {
            .hero-content {
                display: grid;
                grid-template-columns: 1fr 400px;
                gap: 60px;
                text-align: left;
            }

            .nav-anchors {
                position: fixed;
                top: 50%;
                right: 30px;
                transform: translateY(-50%);
                z-index: 999;
                display: flex;
                flex-direction: column;
                gap: 20px;
                background: rgba(0, 0, 0, 0.8);
                padding: 20px 15px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 107, 53, 0.2);
            }

            .anchor-link {
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background: rgba(255, 107, 53, 0.4);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                cursor: pointer;
                position: relative;
                border: 2px solid transparent;
            }

            .container {
                padding: 40px 20px 50px;
            }

            .sticky-cta {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .home-button, .sticky-cta {
                border: 2px solid currentColor;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            html {
                scroll-behavior: auto;
            }
        }

        /* Dark mode optimization (already dark by default) */
        @media (prefers-color-scheme: light) {
            /* Could add light mode styles here if needed */
        }
    </style>

    <!-- Structured Data (same as before) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Andrea Padoan",
        "jobTitle": ["Personal Trainer", "Lifestyle Coach"],
        "description": "Personal Trainer e Lifestyle Coach specializzato nella trasformazione di professionisti e imprenditori a Verona",
        "url": "https://andreapadoan-hub.vercel.app",
        "sameAs": [
            "https://www.personaltrainerverona.it/",
            "https://www.tribuptstudio.it/",
            "https://wa.me/3478881515"
        ],
        "image": "https://andreapadoan-hub.vercel.app/images/chi-sono.jpg",
        "telephone": "+393478881515",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Verona",
            "addressRegion": "Veneto",
            "addressCountry": "IT"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to content per accessibilità -->
    <a href="#main-content" class="skip-link" style="position: absolute; top: -40px; left: 6px; background: #ff6b35; color: white; padding: 8px; text-decoration: none; transition: top 0.3s; z-index: 9999;">Salta al contenuto principale</a>

    <!-- H1 nascosto per SEO -->
    <h1 style="position: absolute; left: -9999px;">Andrea Padoan - Personal Trainer e Lifestyle Coach Verona | La Mia Storia di Trasformazione</h1>

    <!-- Breadcrumb Navigation per SEO -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <div class="breadcrumb-list">
            <a href="https://andreapadoan-hub.vercel.app/" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">›</span>
            <span class="breadcrumb-item active" aria-current="page">Chi Sono</span>
        </div>
    </nav>

    <!-- Tasto Home -->
    <a href="https://andreapadoan-hub.vercel.app/" class="home-button" aria-label="Torna alla homepage">
        <i class="fas fa-home"></i>
        Home
    </a>

    <!-- Navigation Anchors (Desktop) -->
    <div class="nav-anchors" role="navigation" aria-label="Navigazione sezioni pagina">
        <div class="anchor-link" data-target="hero" role="button" tabindex="0" aria-label="Vai alla sezione Chi Sono" style="position: relative;">
            <div style="position: absolute; right: 25px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #ff6b35, #ff8533); color: white; padding: 8px 15px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: all 0.3s ease;">Chi Sono</div>
        </div>
        <div class="anchor-link" data-target="testimonials" role="button" tabindex="0" aria-label="Vai alle testimonianze" style="position: relative;">
            <div style="position: absolute; right: 25px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #ff6b35, #ff8533); color: white; padding: 8px 15px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: all 0.3s ease;">Testimonianze</div>
        </div>
        <div class="anchor-link" data-target="values" role="button" tabindex="0" aria-label="Vai ai miei valori" style="position: relative;">
            <div style="position: absolute; right: 25px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #ff6b35, #ff8533); color: white; padding: 8px 15px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: all 0.3s ease;">I Miei Valori</div>
        </div>
    </div>

    <!-- CTA Sticky WhatsApp -->
    <a href="https://wa.me/3478881515?text=Ciao Andrea, ho letto la tua storia e vorrei iniziare un percorso!" 
       class="sticky-cta" target="_blank" rel="noopener" 
       title="Contattami su WhatsApp"
       aria-label="Contatta Andrea Padoan su WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Main Content -->
    <main id="main-content" class="container">
        <!-- Hero Section -->
        <div id="hero-container" class="component-loading"></div>

        <!-- Intro Blocks -->
        <div id="intro-blocks-container" class="component-loading"></div>

        <!-- Fun Facts -->
        <div id="fun-facts-container" class="component-loading"></div>

        <!-- Testimonianze Google -->
        <div id="testimonials-container" class="component-loading"></div>

        <!-- Story Cards -->
        <div id="story-cards-container" class="component-loading"></div>

        <!-- Values Section -->
        <div id="values-container" class="component-loading"></div>

        <!-- Results Section -->
        <div id="results-container" class="component-loading"></div>

        <!-- Questions Section -->
        <div id="questions-container" class="component-loading"></div>

        <!-- Final CTA -->
        <div id="final-cta-container" class="component-loading"></div>
    </main>

    <!-- PWA Installation Banner -->
    <div id="pwa-install-banner" style="display: none; position: fixed; bottom: 80px; left: 20px; right: 20px; background: linear-gradient(135deg, #ff6b35, #ff8533); color: white; padding: 15px 20px; border-radius: 15px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 999; text-align: center;">
        <div style="margin-bottom: 10px; font-weight: 600;">Installa l'app di Andrea Padoan</div>
        <div style="margin-bottom: 15px; font-size: 14px; opacity: 0.9;">Accesso rapido ai servizi di Personal Training</div>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="pwa-install-btn" style="background: white; color: #ff6b35; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer;">Installa</button>
            <button id="pwa-dismiss-btn" style="background: transparent; color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 16px; border-radius: 8px; cursor: pointer;">Non ora</button>
        </div>
    </div>

    <script>
        // ======================================
        // PWA SISTEMA OTTIMIZZATO MOBILE
        // ======================================

        // Performance metrics
        const perfObserver = new PerformanceObserver((list) => {
            list.getEntries().forEach((entry) => {
                if (entry.entryType === 'navigation') {
                    console.log(`📊 Navigation: ${entry.duration.toFixed(2)}ms`);
                }
                if (entry.entryType === 'paint') {
                    console.log(`🎨 ${entry.name}: ${entry.startTime.toFixed(2)}ms`);
                }
            });
        });
        
        if ('PerformanceObserver' in window) {
            perfObserver.observe({ entryTypes: ['navigation', 'paint'] });
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('🚀 SW registered successfully:', registration);
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('❌ SW registration failed:', error);
                    });
            });
        }

        // PWA Install Banner
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install banner after 3 seconds
            setTimeout(() => {
                showInstallBanner();
            }, 3000);
        });

        function showInstallBanner() {
            const banner = document.getElementById('pwa-install-banner');
            const installBtn = document.getElementById('pwa-install-btn');
            const dismissBtn = document.getElementById('pwa-dismiss-btn');
            
            if (banner && !localStorage.getItem('pwa-install-dismissed')) {
                banner.style.display = 'block';
                banner.style.animation = 'slideInUp 0.5s ease-out';
                
                installBtn.addEventListener('click', async () => {
                    banner.style.display = 'none';
                    
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`PWA install ${outcome}`);
                        deferredPrompt = null;
                    }
                });
                
                dismissBtn.addEventListener('click', () => {
                    banner.style.display = 'none';
                    localStorage.setItem('pwa-install-dismissed', 'true');
                });
            }
        }

        // Touch Gestures
        let touchStartX = 0;
        let touchStartY = 0;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // Swipe detection
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                if (deltaX > 0) {
                    // Swipe right - go back
                    if (window.history.length > 1) {
                        window.history.back();
                    }
                } else {
                    // Swipe left - scroll to next section
                    scrollToNextSection();
                }
            }
        }, { passive: true });

        function scrollToNextSection() {
            const sections = ['hero', 'testimonials', 'values'];
            const currentSection = getCurrentSection();
            const currentIndex = sections.indexOf(currentSection);
            
            if (currentIndex < sections.length - 1) {
                const nextSection = sections[currentIndex + 1];
                const element = document.getElementById(nextSection);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            }
        }

        function getCurrentSection() {
            const sections = ['hero', 'testimonials', 'values'];
            const scrollPos = window.scrollY + window.innerHeight / 2;
            
            for (const sectionId of sections) {
                const section = document.getElementById(sectionId);
                if (section) {
                    const sectionTop = section.offsetTop;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    
                    if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
                        return sectionId;
                    }
                }
            }
            return 'hero';
        }

        // Battery API (when available)
        if ('getBattery' in navigator) {
            navigator.getBattery().then((battery) => {
                // Reduce animations when battery is low
                if (battery.level < 0.2) {
                    document.body.classList.add('low-battery');
                    console.log('🔋 Low battery mode activated');
                }
            });
        }

        // Network Information API
        if ('connection' in navigator) {
            const connection = navigator.connection;
            
            // Adjust quality based on connection
            if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') {
                document.body.classList.add('slow-connection');
                console.log('📶 Slow connection detected');
            }
            
            connection.addEventListener('change', () => {
                console.log(`📶 Connection changed to: ${connection.effectiveType}`);
            });
        }

        // Haptic Feedback (iOS Safari)
        function hapticFeedback(type = 'light') {
            if ('vibrate' in navigator) {
                navigator.vibrate(type === 'light' ? 10 : type === 'medium' ? 20 : 30);
            }
        }

        // Enhanced button interactions
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('button, .home-button, .sticky-cta');
            
            buttons.forEach(button => {
                button.addEventListener('touchstart', () => {
                    hapticFeedback('light');
                }, { passive: true });
            });
        });

        // Lista componenti da caricare (same as before)
        const components = [
            { id: 'hero-container', file: './components/hero-chisono.html' },
            { id: 'intro-blocks-container', file: './components/intro-blocks.html' },
            { id: 'fun-facts-container', file: './components/fun-facts.html' },
            { id: 'testimonials-container', file: './components/testimonials-google.html' },
            { id: 'story-cards-container', file: './components/story-cards.html' },
            { id: 'values-container', file: './components/values-section.html' },
            { id: 'results-container', file: './components/results-section.html' },
            { id: 'questions-container', file: './components/questions-section.html' },
            { id: 'final-cta-container', file: './components/final-cta.html' }
        ];

        // Ottimized component loading with intersection observer
        async function loadComponent(component) {
            try {
                const response = await fetch(component.file);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const html = await response.text();
                const container = document.getElementById(component.id);
                
                if (container) {
                    container.innerHTML = html;
                    container.classList.remove('component-loading');
                    
                    // Trigger animazioni per il componente caricato
                    initAnimationsForContainer(container);
                    
                    console.log(`✅ Component loaded: ${component.file}`);
                } else {
                    console.error(`❌ Container not found: ${component.id}`);
                }
            } catch (error) {
                console.error(`❌ Error loading ${component.file}:`, error);
                handleComponentError(component);
            }
        }

        function handleComponentError(component) {
            const container = document.getElementById(component.id);
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff6b35;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Errore nel caricamento</p>
                        <button onclick="retryComponent('${component.id}', '${component.file}')" style="background: #ff6b35; color: white; border: none; padding: 10px 20px; border-radius: 20px; margin-top: 10px; cursor: pointer;">Riprova</button>
                    </div>
                `;
                container.classList.remove('component-loading');
            }
        }

        window.retryComponent = async function(id, file) {
            const container = document.getElementById(id);
            if (container) {
                container.classList.add('component-loading');
                container.innerHTML = '';
                await loadComponent({ id, file });
            }
        };

        // Intersection Observer for lazy loading
        const componentObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const componentIndex = Array.from(document.querySelectorAll('[id$="-container"]')).indexOf(entry.target);
                    if (componentIndex !== -1 && componentIndex < components.length) {
                        loadComponent(components[componentIndex]);
                        componentObserver.unobserve(entry.target);
                    }
                }
            });
        }, {
            rootMargin: '50px 0px'
        });

        async function loadAllComponents() {
            console.log('🚀 Starting PWA component loading...');
            
            // Load hero immediately
            await loadComponent(components[0]);
            
            // Observe other components for lazy loading
            components.slice(1).forEach((component, index) => {
                const container = document.getElementById(component.id);
                if (container) {
                    componentObserver.observe(container);
                }
            });
        }

        function initAnimationsForContainer(container) {
            const elements = container.querySelectorAll('.animate-on-scroll, .animate-slide-left, .animate-slide-right, .animate-fade-in, .animate-bounce-in');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            elements.forEach(el => observer.observe(el));
        }

        // Global functions
        window.playVideo = function() {
            const placeholder = document.getElementById('videoPlaceholder');
            const player = document.getElementById('videoPlayer');
            const frame = document.getElementById('videoFrame');
            
            if (placeholder && player && frame) {
                placeholder.style.display = 'none';
                player.style.display = 'block';
                
                const videoUrl = 'https://www.youtube.com/embed/vOWTL1Ta8IQ?autoplay=1';
                frame.src = videoUrl;
                
                console.log('🎥 Video player opened');
            }
        };

        window.closeVideo = function() {
            const placeholder = document.getElementById('videoPlaceholder');
            const player = document.getElementById('videoPlayer');
            const frame = document.getElementById('videoFrame');
            
            if (placeholder && player && frame) {
                placeholder.style.display = 'flex';
                player.style.display = 'none';
                frame.src = '';
                
                console.log('🎥 Video player closed');
            }
        };

        window.openChat = function() {
            hapticFeedback('medium');
            const whatsappUrl = 'https://wa.me/3478881515?text=Ciao Andrea, ho letto la tua storia e vorrei parlare dei miei obiettivi di trasformazione!';
            window.open(whatsappUrl, '_blank', 'noopener');
            
            // Track conversion
            if (typeof gtag !== 'undefined') {
                gtag('event', 'whatsapp_contact', {
                    'event_category': 'engagement',
                    'event_label': 'chi_sono_page'
                });
            }
        };

        // Smooth scrolling per anchor links
        function initAnchorLinks() {
            const anchorLinks = document.querySelectorAll('.anchor-link');
            anchorLinks.forEach(link => {
                link.addEventListener('click', handleAnchorClick);
                link.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleAnchorClick.call(this, e);
                    }
                });
            });
        }

        function handleAnchorClick(e) {
            e.preventDefault();
            hapticFeedback('light');
            const target = document.getElementById(this.dataset.target);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function updateActiveAnchor() {
            const sections = ['hero', 'testimonials', 'values'];
            const scrollPos = window.scrollY + 100;

            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const anchor = document.querySelector(`[data-target="${sectionId}"]`);
                
                if (section && anchor) {
                    const sectionTop = section.offsetTop;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    
                    if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
                        document.querySelectorAll('.anchor-link').forEach(a => a.classList.remove('active'));
                        anchor.classList.add('active');
                        anchor.style.background = '#ff6b35';
                        anchor.style.transform = 'scale(1.4)';
                    } else {
                        anchor.style.background = 'rgba(255, 107, 53, 0.4)';
                        anchor.style.transform = 'scale(1)';
                    }
                }
            });
        }

        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; left: 20px; right: 20px; background: #ff6b35; color: white; padding: 15px; border-radius: 10px; z-index: 9999; text-align: center;">
                    <div style="margin-bottom: 10px;">Nuova versione disponibile!</div>
                    <button onclick="location.reload()" style="background: white; color: #ff6b35; border: none; padding: 8px 16px; border-radius: 8px;">Aggiorna</button>
                </div>
            `;
            document.body.appendChild(notification);
        }

        // Initialization
        window.addEventListener('load', () => {
            loadAllComponents();
            initAnchorLinks();
            updateActiveAnchor();
            
            console.log('✅ PWA Chi Sono page loaded successfully!');
        });

        window.addEventListener('scroll', updateActiveAnchor, { passive: true });

        // CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInUp {
                from {
                    transform: translateY(100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            .low-battery * {
                animation-duration: 0.01ms !important;
                transition-duration: 0.1s !important;
            }
            
            .slow-connection img {
                filter: blur(1px);
                transition: filter 0.3s ease;
            }
            
            .slow-connection img:hover {
                filter: none;
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- Google Analytics con eventi PWA -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'Chi Sono PWA - Andrea Padoan Personal Trainer Verona',
            page_location: window.location.href,
            custom_map: {'custom_parameter_1': 'pwa_enabled'}
        });
        
        // PWA specific events
        gtag('event', 'pwa_page_view', {
            'event_category': 'PWA',
            'event_label': 'chi_sono_mobile'
        });
    </script>
</body>
</html>