<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Fitness - Testa il tuo livello | Andrea Padoan</title>
    <meta name="description" content="Scopri il tuo livello di fitness e ricevi consigli personalizzati da Andrea Padoan. Quiz gratuito di 3 minuti.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Animazioni specifiche per il quiz */
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%, #000000 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <div class="quiz-header">
        <a href="./" class="home-btn">
            <i class="fas fa-home"></i>
            Home
        </a>
        <div class="quiz-logo">
            ðŸŽ¯ Fitness Quiz
        </div>
        <div class="progress-container">
            <div class="progress-fill" id="progressBar"></div>
        </div>
    </div>

    <!-- Quiz Container -->
    <div class="quiz-container">
        <div class="quiz-card">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <h1 class="welcome-title">ðŸŽ¯ Testa il Tuo Livello Fitness</h1>
                <p class="welcome-subtitle">
                    Scopri dove sei oggi e ricevi un report personalizzato con consigli specifici per migliorare il tuo benessere
                </p>
                
                <div class="welcome-features">
                    <div class="welcome-feature">
                        <i class="fas fa-chart-line"></i>
                        <h3>Analisi Completa</h3>
                        <p>Valutiamo fitness, alimentazione, abitudini e motivazione con algoritmi avanzati</p>
                    </div>
                    <div class="welcome-feature">
                        <i class="fas fa-star"></i>
                        <h3>Score Personalizzato</h3>
                        <p>Ricevi un punteggio da 1 a 5 per ogni area della tua vita con consigli mirati</p>
                    </div>
                    <div class="welcome-feature">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Consigli AI</h3>
                        <p>Suggerimenti basati su AI per migliorare immediatamente le tue abitudini</p>
                    </div>
                </div>
                
                <button class="start-quiz-btn" onclick="showUserInfoForm()">
                    <i class="fas fa-rocket"></i>
                    Inizia il Quiz (3 min)
                </button>
            </div>

            <!-- User Info Screen -->
            <div class="user-info-screen" id="userInfoScreen">
                <h2 class="info-title">ðŸš€ Iniziamo!</h2>
                <p class="info-subtitle">Per personalizzare al meglio il tuo report, inserisci i tuoi dati</p>
                
                <div class="form-group">
                    <label for="userName">âœ¨ Il tuo nome</label>
                    <input type="text" id="userName" placeholder="Inserisci il tuo nome" required>
                </div>
                
                <div class="form-group">
                    <label for="userPhone">ðŸ“± Il tuo numero di telefono</label>
                    <input type="tel" id="userPhone" placeholder="Inserisci il tuo numero (es. 3331234567)" required>
                </div>
                
                <button class="continue-btn" id="continueBtn" onclick="startQuizFromForm()" disabled>
                    <i class="fas fa-arrow-right"></i>
                    Continua con il Quiz
                </button>
            </div>

            <!-- Quiz Screen -->
            <div class="quiz-screen" id="quizScreen">
                <div class="question-counter" id="questionCounter">Domanda 1 di 20</div>
                <h2 class="question-title" id="questionTitle"></h2>
                <div class="answers-grid" id="answersGrid"></div>
                
                <div class="quiz-navigation">
                    <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" disabled>
                        <i class="fas fa-arrow-left"></i>
                        Precedente
                    </button>
                    <button class="nav-btn next-btn" id="nextBtn" onclick="nextQuestion()" disabled>
                        Prossima
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div class="loading-screen" id="loadingScreen">
                <h2 class="loading-title">ðŸ§  Analizzo i tuoi risultati...</h2>
                <div class="loading-spinner"></div>
                <p class="loading-text">Sto creando il tuo report personalizzato con AI</p>
            </div>

            <!-- Saving Screen -->
            <div class="saving-screen" id="savingScreen">
                <h2 class="saving-title">ðŸ’¾ Salvando i tuoi risultati...</h2>
                <div class="saving-spinner"></div>
                
                <div class="saving-steps">
                    <div class="saving-step completed" id="step1">
                        <i class="fas fa-check"></i>
                        <span>Analisi completata</span>
                    </div>
                    <div class="saving-step current" id="step2">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Salvando su database...</span>
                    </div>
                    <div class="saving-step" id="step3">
                        <i class="fas fa-clock"></i>
                        <span>Preparando il report</span>
                    </div>
                    <div class="saving-step" id="step4">
                        <i class="fas fa-clock"></i>
                        <span>Finalizzazione</span>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen" id="resultsScreen">
                <div class="success-badge">
                    <i class="fas fa-trophy"></i>
                    Risultati salvati con successo!
                </div>
                
                <h2 class="results-title">ðŸŽ‰ Ecco il Tuo Report!</h2>
                <p class="results-subtitle">Analisi completa del tuo stile di vita powered by AI</p>
                
                <div class="results-grid" id="resultsGrid"></div>
                
                <div class="results-report">
                    <h3 class="report-title">ðŸ“‹ Report Personalizzato</h3>
                    <div class="report-text" id="reportText"></div>
                </div>
                
                <div class="results-actions">
                    <a href="#" class="action-btn primary-action" id="whatsappBtn" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        ðŸ“ž Prendi Appuntamento
                    </a>
                    <a href="#" class="action-btn secondary-action" onclick="openChat()">
                        <i class="fas fa-comments"></i>
                        ðŸ’¬ Chiedimi Informazioni
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div class="confetti" id="confetti"></div>

    <script>
        // Quiz Data - Tutte le 20 domande complete
        const quizQuestions = [
            {
                id: 1,
                category: "fitness",
                question: "Quante volte ti alleni alla settimana?",
                answers: [
                    { text: "Mai o raramente", score: 1 },
                    { text: "1-2 volte", score: 2 },
                    { text: "3-4 volte", score: 4 },
                    { text: "5+ volte", score: 5 }
                ]
            },
            {
                id: 2,
                category: "fitness",
                question: "Come descriveresti il tuo livello di energia durante il giorno?",
                answers: [
                    { text: "Sempre stanco e spossato", score: 1 },
                    { text: "Spesso stanco, soprattutto nel pomeriggio", score: 2 },
                    { text: "Generalmente buono, con qualche calo", score: 3 },
                    { text: "Alto e costante per tutta la giornata", score: 5 }
                ]
            },
            {
                id: 3,
                category: "alimentazione",
                question: "Quanti pasti principali fai al giorno?",
                answers: [
                    { text: "1-2 pasti, spesso salto la colazione", score: 1 },
                    { text: "2-3 pasti irregolari", score: 2 },
                    { text: "3 pasti regolari", score: 4 },
                    { text: "3 pasti + spuntini sani", score: 5 }
                ]
            },
            {
                id: 4,
                category: "alimentazione",
                question: "Quanto spesso mangi frutta e verdura?",
                answers: [
                    { text: "Raramente, meno di 2 porzioni al giorno", score: 1 },
                    { text: "2-3 porzioni al giorno", score: 2 },
                    { text: "4-5 porzioni al giorno", score: 4 },
                    { text: "5+ porzioni al giorno", score: 5 }
                ]
            },
            {
                id: 5,
                category: "abitudini",
                question: "Quante ore dormi mediamente per notte?",
                answers: [
                    { text: "Meno di 5 ore", score: 1 },
                    { text: "5-6 ore", score: 2 },
                    { text: "7-8 ore", score: 5 },
                    { text: "PiÃ¹ di 9 ore", score: 3 }
                ]
            },
            {
                id: 6,
                category: "abitudini",
                question: "Quanto tempo passi davanti agli schermi (TV, telefono, computer) nel tempo libero?",
                answers: [
                    { text: "PiÃ¹ di 6 ore al giorno", score: 1 },
                    { text: "4-6 ore al giorno", score: 2 },
                    { text: "2-4 ore al giorno", score: 3 },
                    { text: "Meno di 2 ore al giorno", score: 5 }
                ]
            },
            {
                id: 7,
                category: "motivazione",
                question: "Quanto sei motivato a migliorare la tua forma fisica?",
                answers: [
                    { text: "Per niente, non Ã¨ una prioritÃ ", score: 1 },
                    { text: "Poco, ci penso ma non agisco", score: 2 },
                    { text: "Abbastanza, ho provato ma senza costanza", score: 3 },
                    { text: "Molto, sono pronto a impegnarmi seriamente", score: 5 }
                ]
            },
            {
                id: 8,
                category: "stress",
                question: "Come gestisci lo stress quotidiano?",
                answers: [
                    { text: "Non lo gestisco, mi sento sempre sopraffatto", score: 1 },
                    { text: "Con difficoltÃ , spesso sono ansioso", score: 2 },
                    { text: "Abbastanza bene, con alcune tecniche", score: 4 },
                    { text: "Molto bene, ho strategie efficaci", score: 5 }
                ]
            },
            {
                id: 9,
                category: "fitness",
                question: "Quanto tempo puoi dedicare all'attivitÃ  fisica ogni giorno?",
                answers: [
                    { text: "Nessuno, non ho tempo", score: 1 },
                    { text: "15-30 minuti", score: 3 },
                    { text: "30-60 minuti", score: 4 },
                    { text: "PiÃ¹ di 1 ora", score: 5 }
                ]
            },
            {
                id: 10,
                category: "alimentazione",
                question: "Quanto spesso mangi cibi processati o fast food?",
                answers: [
                    { text: "Quasi ogni giorno", score: 1 },
                    { text: "3-4 volte a settimana", score: 2 },
                    { text: "1-2 volte a settimana", score: 3 },
                    { text: "Raramente o mai", score: 5 }
                ]
            },
            {
                id: 11,
                category: "abitudini",
                question: "Quanto acqua bevi al giorno?",
                answers: [
                    { text: "Meno di 1 litro", score: 1 },
                    { text: "1-1.5 litri", score: 2 },
                    { text: "1.5-2 litri", score: 4 },
                    { text: "PiÃ¹ di 2 litri", score: 5 }
                ]
            },
            {
                id: 12,
                category: "motivazione",
                question: "Qual Ã¨ il tuo principale ostacolo nel mantenersi in forma?",
                answers: [
                    { text: "Mancanza totale di motivazione", score: 1 },
                    { text: "Non so da dove iniziare", score: 2 },
                    { text: "Mancanza di tempo", score: 3 },
                    { text: "Non ho ostacoli significativi", score: 5 }
                ]
            },
            {
                id: 13,
                category: "fitness",
                question: "Come ti senti fisicamente dopo una giornata di lavoro?",
                answers: [
                    { text: "Completamente esausto", score: 1 },
                    { text: "Molto stanco e dolorante", score: 2 },
                    { text: "Stanco ma gestibile", score: 3 },
                    { text: "Energico e pronto per altre attivitÃ ", score: 5 }
                ]
            },
            {
                id: 14,
                category: "alimentazione",
                question: "Pianifichi i tuoi pasti in anticipo?",
                answers: [
                    { text: "Mai, mangio quello che capita", score: 1 },
                    { text: "Raramente, solo occasionalmente", score: 2 },
                    { text: "A volte, per alcuni pasti", score: 3 },
                    { text: "Sempre, ho un piano alimentare", score: 5 }
                ]
            },
            {
                id: 15,
                category: "stress",
                question: "Quanto spesso ti senti ansioso o stressato?",
                answers: [
                    { text: "Quasi sempre", score: 1 },
                    { text: "Spesso (4-5 giorni a settimana)", score: 2 },
                    { text: "A volte (2-3 giorni a settimana)", score: 3 },
                    { text: "Raramente o mai", score: 5 }
                ]
            },
            {
                id: 16,
                category: "abitudini",
                question: "Hai una routine mattutina strutturata?",
                answers: [
                    { text: "No, ogni mattina Ã¨ caotica", score: 1 },
                    { text: "A volte, dipende dalla giornata", score: 2 },
                    { text: "SÃ¬, ma semplice", score: 4 },
                    { text: "SÃ¬, dettagliata e motivante", score: 5 }
                ]
            },
            {
                id: 17,
                category: "motivazione",
                question: "Hai mai seguito un programma fitness per piÃ¹ di 3 mesi?",
                answers: [
                    { text: "Mai", score: 1 },
                    { text: "SÃ¬, ma ho smesso", score: 2 },
                    { text: "SÃ¬, con interruzioni", score: 3 },
                    { text: "SÃ¬, con costanza", score: 5 }
                ]
            },
            {
                id: 18,
                category: "fitness",
                question: "Come valuti la tua forza fisica attuale?",
                answers: [
                    { text: "Molto scarsa", score: 1 },
                    { text: "Sotto la media", score: 2 },
                    { text: "Nella media", score: 3 },
                    { text: "Buona o eccellente", score: 5 }
                ]
            },
            {
                id: 19,
                category: "alimentazione",
                question: "Quanto spesso cucini pasti sani a casa?",
                answers: [
                    { text: "Mai, mangio sempre fuori", score: 1 },
                    { text: "1-2 volte a settimana", score: 2 },
                    { text: "3-5 volte a settimana", score: 4 },
                    { text: "Quasi sempre", score: 5 }
                ]
            },
            {
                id: 20,
                category: "motivazione",
                question: "Qual Ã¨ il tuo obiettivo principale?",
                answers: [
                    { text: "Non ho obiettivi chiari", score: 1 },
                    { text: "Perdere peso", score: 3 },
                    { text: "Aumentare energia e benessere", score: 4 },
                    { text: "Trasformazione completa dello stile di vita", score: 5 }
                ]
            }
        ];

        // Quiz State
        let currentQuestion = 0;
        let answers = {};
        let userName = '';
        let userPhone = '';
        let quizResults = {};

        // Initialize floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 15;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 8 + 4 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = Math.random() * 6 + 6 + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Show confetti animation
        function showConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#ff6b35', '#ffaa80', '#ff8533'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confettiContainer.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 100);
            }
        }

        // Functions
        function showUserInfoForm() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('userInfoScreen').style.display = 'block';
            
            const nameInput = document.getElementById('userName');
            const phoneInput = document.getElementById('userPhone');
            const continueBtn = document.getElementById('continueBtn');
            
            function checkInputs() {
                if (nameInput.value.trim() && phoneInput.value.trim()) {
                    continueBtn.disabled = false;
                } else {
                    continueBtn.disabled = true;
                }
            }
            
            nameInput.addEventListener('input', checkInputs);
            phoneInput.addEventListener('input', checkInputs);
        }

        function startQuizFromForm() {
            userName = document.getElementById('userName').value.trim();
            userPhone = document.getElementById('userPhone').value.trim();
            
            if (!userName || !userPhone) {
                alert('Per favore, inserisci nome e telefono per continuare');
                return;
            }
            
            document.getElementById('userInfoScreen').style.display = 'none';
            document.getElementById('quizScreen').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            const question = quizQuestions[currentQuestion];
            document.getElementById('questionCounter').textContent = `Domanda ${currentQuestion + 1} di ${quizQuestions.length}`;
            document.getElementById('questionTitle').textContent = question.question;
            
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const answerElement = document.createElement('div');
                answerElement.className = 'answer-option';
                answerElement.textContent = answer.text;
                answerElement.onclick = () => selectAnswer(index, answer.score);
                answersGrid.appendChild(answerElement);
            });
            
            updateProgress();
            updateNavigation();
        }

        function selectAnswer(answerIndex, score) {
            // Remove previous selection
            document.querySelectorAll('.answer-option').forEach(el => el.classList.remove('selected'));
            
            // Add selection to clicked answer with animation
            const selectedOption = document.querySelectorAll('.answer-option')[answerIndex];
            selectedOption.classList.add('selected');
            
            // Add pulse effect
            selectedOption.style.animation = 'none';
            setTimeout(() => {
                selectedOption.style.animation = 'pulse 0.6s ease';
            }, 10);
            
            // Store answer
            answers[currentQuestion] = {
                questionId: quizQuestions[currentQuestion].id,
                category: quizQuestions[currentQuestion].category,
                score: score,
                answerIndex: answerIndex,
                answerText: quizQuestions[currentQuestion].answers[answerIndex].text
            };
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            if (currentQuestion < quizQuestions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                finishQuiz();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
                
                // Restore previous answer if exists
                if (answers[currentQuestion]) {
                    const answerIndex = answers[currentQuestion].answerIndex;
                    document.querySelectorAll('.answer-option')[answerIndex].classList.add('selected');
                    document.getElementById('nextBtn').disabled = false;
                }
            }
        }

        function updateProgress() {
            const totalSteps = quizQuestions.length + 1;
            const currentStep = currentQuestion + 2;
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function updateNavigation() {
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').disabled = !answers[currentQuestion];
            
            if (currentQuestion === quizQuestions.length - 1) {
                document.getElementById('nextBtn').innerHTML = '<i class="fas fa-trophy"></i> Completa Quiz';
            } else {
                document.getElementById('nextBtn').innerHTML = 'Prossima <i class="fas fa-arrow-right"></i>';
            }
        }

        function finishQuiz() {
            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            setTimeout(() => {
                calculateResults();
                saveToAirtable();
            }, 3000);
        }

        function calculateResults() {
            const categoryScores = {
                fitness: { total: 0, count: 0 },
                alimentazione: { total: 0, count: 0 },
                abitudini: { total: 0, count: 0 },
                motivazione: { total: 0, count: 0 },
                stress: { total: 0, count: 0 }
            };
            
            Object.values(answers).forEach(answer => {
                if (categoryScores[answer.category]) {
                    categoryScores[answer.category].total += answer.score;
                    categoryScores[answer.category].count++;
                }
            });
            
            for (let category in categoryScores) {
                if (categoryScores[category].count > 0) {
                    categoryScores[category].average = Math.round(categoryScores[category].total / categoryScores[category].count);
                }
            }
            
            quizResults = categoryScores;
        }

        async function saveToAirtable() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('savingScreen').style.display = 'block';
            
            // Simulate saving steps with animations
            setTimeout(() => {
                document.getElementById('step2').classList.remove('current');
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step2').innerHTML = '<i class="fas fa-check"></i><span>Salvato su database</span>';
                
                document.getElementById('step3').classList.add('current');
                document.getElementById('step3').innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Preparando il report</span>';
            }, 1500);
            
            setTimeout(() => {
                document.getElementById('step3').classList.remove('current');
                document.getElementById('step3').classList.add('completed');
                document.getElementById('step3').innerHTML = '<i class="fas fa-check"></i><span>Report preparato</span>';
                
                document.getElementById('step4').classList.add('current');
                document.getElementById('step4').innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Finalizzazione</span>';
            }, 3000);
            
            // Prepare data for Airtable
            const overallScore = Object.values(quizResults)
                .filter(cat => cat.count > 0)
                .reduce((sum, cat) => sum + cat.average, 0) / 
                Object.values(quizResults).filter(cat => cat.count > 0).length;
            
            const quizData = {
                name: userName,
                phone: userPhone,
                timestamp: new Date().toISOString(),
                fitness_score: quizResults.fitness.average,
                alimentazione_score: quizResults.alimentazione.average,
                abitudini_score: quizResults.abitudini.average,
                motivazione_score: quizResults.motivazione.average,
                stress_score: quizResults.stress.average,
                overall_score: Math.round(overallScore * 10) / 10,
                report_generated: generateDetailedReport(),
                answers_json: JSON.stringify(answers),
                lead_priority: calculateLeadPriority(overallScore),
                follow_up_status: 'New'
            };
            
            try {
                const response = await fetch('/api/save-quiz-result', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(quizData)
                });
                
                if (response.ok) {
                    console.log('âœ… Quiz results saved to Airtable successfully');
                    
                    setTimeout(() => {
                        document.getElementById('step4').classList.remove('current');
                        document.getElementById('step4').classList.add('completed');
                        document.getElementById('step4').innerHTML = '<i class="fas fa-check"></i><span>Completato!</span>';
                        
                        setTimeout(() => {
                            showResults();
                            showConfetti(); // Show confetti on success
                        }, 1000);
                    }, 1500);
                } else {
                    throw new Error('Failed to save to Airtable');
                }
                
            } catch (error) {
                console.error('âŒ Error saving to Airtable:', error);
                
                setTimeout(() => {
                    document.getElementById('step4').classList.remove('current');
                    document.getElementById('step4').innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #ff6b35;"></i><span>Salvataggio locale</span>';
                    
                    setTimeout(() => {
                        showResults();
                    }, 1000);
                }, 1500);
            }
        }

        function calculateLeadPriority(overallScore) {
            if (overallScore <= 2.0) return 'High';
            if (overallScore <= 3.5) return 'Medium';
            return 'Low';
        }

        function showResults() {
            document.getElementById('savingScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '';
            
            const categoryNames = {
                fitness: 'Forma Fisica',
                alimentazione: 'Alimentazione',
                abitudini: 'Abitudini Salutari',
                motivazione: 'Motivazione',
                stress: 'Gestione Stress'
            };
            
            // Display category scores with animations
            for (let category in quizResults) {
                if (quizResults[category].count > 0) {
                    const score = quizResults[category].average;
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'result-category';
                    categoryElement.innerHTML = `
                        <div class="category-name">${categoryNames[category]}</div>
                        <div class="score-display">
                            ${Array.from({length: 5}, (_, i) => 
                                `<i class="fas fa-star score-star ${i < score ? 'filled' : ''}"></i>`
                            ).join('')}
                        </div>
                        <div class="category-description">${getScoreDescription(score)}</div>
                    `;
                    resultsGrid.appendChild(categoryElement);
                }
            }
            
            // Generate and display detailed report
            const detailedReport = generateDetailedReport();
            document.getElementById('reportText').textContent = detailedReport;
            
            // Update WhatsApp link with user data
            updateWhatsAppLink();
            
            // Complete progress bar
            document.getElementById('progressBar').style.width = '100%';
        }

        function getScoreDescription(score) {
            const descriptions = {
                1: 'Area che necessita miglioramento immediato',
                2: 'C\'Ã¨ spazio per crescere',
                3: 'Livello discreto, ma migliorabile',
                4: 'Buon livello, continua cosÃ¬',
                5: 'Eccellente! Sei un esempio'
            };
            return descriptions[score] || '';
        }

        function generateDetailedReport() {
            const scores = quizResults;
            const categoryNames = {
                fitness: 'Forma Fisica',
                alimentazione: 'Alimentazione',
                abitudini: 'Abitudini Salutari',
                motivazione: 'Motivazione',
                stress: 'Gestione Stress'
            };
            
            const validScores = Object.values(scores).filter(cat => cat.count > 0);
            const overallAverage = validScores.reduce((sum, cat) => sum + cat.average, 0) / validScores.length;
            
            const sortedCategories = Object.entries(scores)
                .filter(([_, data]) => data.count > 0)
                .sort(([_, a], [__, b]) => a.average - b.average);
            
            const weakestArea = sortedCategories[0];
            const strongestArea = sortedCategories[sortedCategories.length - 1];
            
            let report = `ðŸŽ¯ Ciao ${userName}! Grazie per aver completato il quiz fitness completo.

ðŸ“Š RISULTATO COMPLESSIVO: ${overallAverage.toFixed(1)}/5.0

Il tuo punteggio generale ti colloca in un livello ${getOverallLevel(overallAverage)}. Questo significa che hai ${getOverallDescription(overallAverage)}

ðŸ” ANALISI DETTAGLIATA PER AREA:

ðŸ’ª FORMA FISICA (${scores.fitness.average}/5): ${getDetailedCategoryAnalysis('fitness', scores.fitness.average)}

ðŸ¥— ALIMENTAZIONE (${scores.alimentazione.average}/5): ${getDetailedCategoryAnalysis('alimentazione', scores.alimentazione.average)}

ðŸŒ™ ABITUDINI SALUTARI (${scores.abitudini.average}/5): ${getDetailedCategoryAnalysis('abitudini', scores.abitudini.average)}

ðŸŽ¯ MOTIVAZIONE (${scores.motivazione.average}/5): ${getDetailedCategoryAnalysis('motivazione', scores.motivazione.average)}

ðŸ§˜â€â™‚ï¸ GESTIONE STRESS (${scores.stress.average}/5): ${getDetailedCategoryAnalysis('stress', scores.stress.average)}

ðŸ“ˆ AREA DI FORZA: La tua area migliore Ã¨ ${categoryNames[strongestArea[0]]} con ${strongestArea[1].average}/5. Questa Ã¨ una grande risorsa su cui costruire il tuo percorso di miglioramento.

âš ï¸ AREA DI MIGLIORAMENTO PRIORITARIA: ${categoryNames[weakestArea[0]]} ha ottenuto ${weakestArea[1].average}/5. Concentrandoti prima su questa area, vedrai miglioramenti significativi in tutto il tuo benessere generale.

ðŸŽ¯ PIANO D'AZIONE PERSONALIZZATO:

${getPersonalizedActionPlan(scores, weakestArea[0], strongestArea[0])}

ðŸ’¡ CONSIGLI PRATICI IMMEDIATI:
${getImmediateTips(scores)}

ðŸš€ PROSSIMI PASSI:
Basandoti sui tuoi risultati, il mio consiglio Ã¨ di iniziare con piccoli cambiamenti nella tua area piÃ¹ debole mentre mantieni i punti di forza che giÃ  possiedi. 

Un approccio graduale e sostenibile Ã¨ la chiave per trasformazioni durature. Non cercare di cambiare tutto insieme, ma concentrati su 1-2 abitudini alla volta.

Con il tuo livello attuale e la giusta strategia personalizzata, puoi raggiungere risultati straordinari in 3-6 mesi.

ðŸ’ª Ricorda: ogni grande trasformazione inizia con la decisione di fare il primo passo. Tu l'hai giÃ  fatto completando questo quiz!

Sono qui per supportarti in questo percorso verso la migliore versione di te stesso.`;

            return report;
        }

        function getOverallLevel(score) {
            if (score >= 4.5) return 'ECCELLENTE';
            if (score >= 4.0) return 'MOLTO BUONO';
            if (score >= 3.0) return 'BUONO';
            if (score >= 2.0) return 'DISCRETO';
            return 'DA MIGLIORARE';
        }

        function getOverallDescription(score) {
            if (score >= 4.5) return 'giÃ  ottime abitudini di vita e un approccio molto disciplinato al benessere.';
            if (score >= 4.0) return 'buone basi solide e alcune aree di eccellenza nel tuo stile di vita.';
            if (score >= 3.0) return 'una situazione equilibrata con spazio per miglioramenti mirati.';
            if (score >= 2.0) return 'diverse opportunitÃ  di crescita per elevare il tuo livello di benessere.';
            return 'molto potenziale di miglioramento e la possibilitÃ  di trasformare completamente il tuo stile di vita.';
        }

        function getDetailedCategoryAnalysis(category, score) {
            const analyses = {
                fitness: {
                    1: 'La tua forma fisica necessita attenzione immediata. Probabilmente hai uno stile di vita sedentario e ti senti spesso stanco. Ãˆ il momento di introdurre movimento nella tua routine quotidiana.',
                    2: 'La tua forma fisica Ã¨ sotto la media. Fai qualche attivitÃ  sporadica ma manca costanza. Con un programma strutturato vedrai miglioramenti rapidi.',
                    3: 'La tua forma fisica Ã¨ discreta. Hai alcune buone abitudini ma potresti essere piÃ¹ costante e strutturato negli allenamenti.',
                    4: 'La tua forma fisica Ã¨ buona! Sei attivo regolarmente. Ora puoi concentrarti su obiettivi specifici e sfide piÃ¹ avanzate.',
                    5: 'La tua forma fisica Ã¨ eccellente! Sei un esempio di costanza e disciplina. Mantieni questo livello e magari inspira altri.'
                },
                alimentazione: {
                    1: 'La tua alimentazione necessita una revisione completa. Probabilmente mangi spesso fuori casa, salti pasti e consumi molti cibi processati.',
                    2: 'La tua alimentazione Ã¨ irregolare. Ci sono giorni buoni e giorni meno buoni. Hai bisogno di piÃ¹ struttura e pianificazione.',
                    3: 'La tua alimentazione Ã¨ nella media. Fai alcune scelte sane ma ci sono ancora abitudini da migliorare, come la pianificazione dei pasti.',
                    4: 'La tua alimentazione Ã¨ buona! Fai scelte consapevoli nella maggior parte dei casi. Puoi perfezionare alcuni dettagli.',
                    5: 'La tua alimentazione Ã¨ eccellente! Pianifichi bene, mangi vario e sano. Sei un modello da seguire.'
                },
                abitudini: {
                    1: 'Le tue abitudini quotidiane necessitano una ristrutturazione completa. Sonno irregolare, troppo tempo davanti agli schermi e mancanza di routine.',
                    2: 'Le tue abitudini sono instabili. Alcuni giorni sono migliori di altri, ma manca una struttura costante nella tua giornata.',
                    3: 'Le tue abitudini sono discrete. Hai una routine di base ma potresti ottimizzare il sonno e ridurre il tempo davanti agli schermi.',
                    4: 'Le tue abitudini sono buone! Hai una routine strutturata. Puoi perfezionare alcuni aspetti per massimizzare il benessere.',
                    5: 'Le tue abitudini sono eccellenti! Hai una routine perfetta che supporta il tuo benessere in ogni aspetto.'
                },
                motivazione: {
                    1: 'La tua motivazione Ã¨ molto bassa. Probabilmente ti senti sopraffatto e non sai da dove iniziare. Hai bisogno di obiettivi chiari e raggiungibili.',
                    2: 'La tua motivazione Ã¨ incostante. Hai momenti di entusiasmo seguiti da periodi di abbandono. Serve una strategia piÃ¹ sostenibile.',
                    3: 'La tua motivazione Ã¨ media. Hai buone intenzioni ma a volte ti manca la spinta per agire. Obiettivi piÃ¹ specifici potrebbero aiutarti.',
                    4: 'La tua motivazione Ã¨ buona! Sei determinato e hai obiettivi chiari. Continua cosÃ¬ e celebra i progressi fatti.',
                    5: 'La tua motivazione Ã¨ eccezionale! Sei disciplinato, costante e ispiri gli altri con la tua determinazione.'
                },
                stress: {
                    1: 'Il tuo livello di stress Ã¨ molto alto e sta probabilmente impattando negativamente su tutti gli altri aspetti della tua vita. Ãˆ fondamentale imparare tecniche di gestione.',
                    2: 'Il tuo stress Ã¨ sopra la media. Ti senti spesso sopraffatto e hai bisogno di strategie efficaci per gestire le pressioni quotidiane.',
                    3: 'Il tuo stress Ã¨ gestibile nella maggior parte dei casi, ma ci sono momenti in cui ti senti sotto pressione. Potresti beneficiare di tecniche di rilassamento.',
                    4: 'Gestisci bene lo stress! Hai strategie efficaci e riesci a mantenere l\'equilibrio nella maggior parte delle situazioni.',
                    5: 'La tua gestione dello stress Ã¨ eccellente! Rimani calmo e centrato anche nelle situazioni difficili. Le tue tecniche sono un esempio per altri.'
                }
            };
            return analyses[category][score] || '';
        }

        function getPersonalizedActionPlan(scores, weakestArea, strongestArea) {
            let plan = `Considerando il tuo profilo specifico, ecco il piano d'azione che ti consiglio:

FASE 1 (Prime 2 settimane): Concentrati su ${getCategoryName(weakestArea)}
${getAreaSpecificPlan(weakestArea, 'phase1')}

FASE 2 (Settimane 3-6): Mantieni i progressi e aggiungi ${getCategoryName(getSecondWeakestArea(scores))}
${getAreaSpecificPlan(weakestArea, 'phase2')}

FASE 3 (Settimane 7-12): Integrazione completa
Ora che hai consolidato le basi, Ã¨ il momento di integrare tutto e alzare l'asticella. Usa il tuo punto di forza (${getCategoryName(strongestArea)}) come leva per motivarti nelle altre aree.`;

            return plan;
        }

        function getCategoryName(category) {
            const names = {
                fitness: 'la forma fisica',
                alimentazione: 'l\'alimentazione',
                abitudini: 'le abitudini salutari',
                motivazione: 'la motivazione',
                stress: 'la gestione dello stress'
            };
            return names[category] || category;
        }

        function getSecondWeakestArea(scores) {
            const sorted = Object.entries(scores)
                .filter(([_, data]) => data.count > 0)
                .sort(([_, a], [__, b]) => a.average - b.average);
            return sorted[1] ? sorted[1][0] : sorted[0][0];
        }

        function getAreaSpecificPlan(area, phase) {
            const plans = {
                fitness: {
                    phase1: 'â€¢ Inizia con 15-20 minuti di camminata veloce al giorno\nâ€¢ Fai 2 sessioni di esercizi a corpo libero (10 minuti)\nâ€¢ Scegli le scale invece dell\'ascensore',
                    phase2: 'â€¢ Aumenta a 30 minuti di attivitÃ  cardiovascolare\nâ€¢ Aggiungi 3 sessioni di allenamento strutturato\nâ€¢ Trova un\'attivitÃ  che ti diverte (danza, sport, ecc.)'
                },
                alimentazione: {
                    phase1: 'â€¢ Pianifica 3 pasti principali e 2 spuntini sani\nâ€¢ Aumenta l\'acqua a 2 litri al giorno\nâ€¢ Aggiungi una porzione di verdura a ogni pasto',
                    phase2: 'â€¢ Prepara i pasti della settimana ogni domenica\nâ€¢ Riduci i cibi processati del 50%\nâ€¢ Sperimenta con ricette sane che ti piacciono'
                },
                abitudini: {
                    phase1: 'â€¢ Vai a letto e svegliati alla stessa ora ogni giorno\nâ€¢ Crea una routine serale rilassante (no schermi 1 ora prima)\nâ€¢ Limita il tempo sui social a 1 ora al giorno',
                    phase2: 'â€¢ Aggiungi una routine mattutina energizzante\nâ€¢ Implementa pause attive ogni 2 ore di lavoro\nâ€¢ Crea un ambiente per dormire ottimale'
                },
                motivazione: {
                    phase1: 'â€¢ Scrivi 3 obiettivi specifici e misurabili\nâ€¢ Celebra ogni piccolo progresso\nâ€¢ Trova un partner di accountability',
                    phase2: 'â€¢ Traccia i tuoi progressi settimanalmente\nâ€¢ Premiati per i traguardi raggiunti\nâ€¢ Visualizza quotidianamente i tuoi obiettivi'
                },
                stress: {
                    phase1: 'â€¢ Pratica 5 minuti di respirazione profonda al giorno\nâ€¢ Dedica 15 minuti solo a te stesso ogni giorno\nâ€¢ Identifica i tuoi principali stressor',
                    phase2: 'â€¢ Prova la meditazione guidata (10 minuti)\nâ€¢ Implementa tecniche di time management\nâ€¢ Crea confini chiari tra lavoro e vita privata'
                }
            };
            return plans[area][phase] || '';
        }

        function getImmediateTips(scores) {
            let tips = [];
            
            if (scores.fitness.average <= 2) {
                tips.push('â€¢ OGGI: Fai una camminata di 10 minuti dopo pranzo');
            }
            if (scores.alimentazione.average <= 2) {
                tips.push('â€¢ OGGI: Bevi un bicchiere d\'acqua prima di ogni pasto');
            }
            if (scores.abitudini.average <= 2) {
                tips.push('â€¢ OGGI: Metti il telefono in modalitÃ  aereo 1 ora prima di dormire');
            }
            if (scores.motivazione.average <= 2) {
                tips.push('â€¢ OGGI: Scrivi un obiettivo specifico che vuoi raggiungere questa settimana');
            }
            if (scores.stress.average <= 2) {
                tips.push('â€¢ OGGI: Pratica 3 respiri profondi ogni volta che ti senti stressato');
            }
            
            return tips.join('\n');
        }

        function updateWhatsAppLink() {
            const weakestArea = Object.entries(quizResults)
                .filter(([_, data]) => data.count > 0)
                .sort(([_, a], [__, b]) => a.average - b.average)[0];
            
            const message = `Ciao Andrea! Ho completato il quiz fitness e sono ${userName} (tel: ${userPhone}). I miei risultati mostrano che devo migliorare soprattutto ${getCategoryName(weakestArea[0])}. Mi piacerebbe prenotare una consulenza per creare un piano personalizzato. Grazie!`;
            
            document.getElementById('whatsappBtn').href = `https://wa.me/3478881515?text=${encodeURIComponent(message)}`;
        }

        function openChat() {
            alert('La funzione chat sarÃ  disponibile a breve! Per ora puoi contattarmi su WhatsApp per qualsiasi domanda ðŸ˜Š');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸŽ¯ Quiz loaded with', quizQuestions.length, 'questions');
            createParticles();
        });
    </script>
</body>
</html>